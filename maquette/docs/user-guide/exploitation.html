<?xml version="1.0" encoding="ISO-8859-1"?>
<html>
   <head>
      <title>Documentation Utilisateur Xemelios</title>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
         <style type="text/css">
           p.header { text-align: center; margin: 0 10 5 10; font-family: Helvetica; font-size: 18px; font-weight: bold; }
           p { text-align: left; font-family: Helvetica; }
           p.p1 { margin-left: 10px; }
           p.p2 { margin-left: 20px; }
           p.p3 { margin-left: 30px; }
           p.p4 { margin-left: 40px; margin-top: 2px; }
           p.center { text-align: center; }
           h1 { font-family: Helvetica; font-size: 22px; font-weight: bold; }
           h2 { margin-left: 10px; font-family: Helvetica; font-size: 18px; font-weight: bold; }
           h3 { margin-left: 20px; font-family: Helvetica; font-size: 16px; font-weight: bold; }
           h4 { margin-left: 30px; margin-bottom: 0px; }
           table { background-color: black; cell-spacing: 1px; }
           td { background-color: white; }
           td.center { text-align:center; }
           th { background-color: #9F9F9F; text-align: left; }
           a { font-family: Helvetica; }
           span.code { font-family: monospace; font-size: larger; font-weight: bold; }
         </style>
   </head>
   <body>
      <p class="header"><img src="images/logo_xemelios.png" alt="logo"/></p>
      <p class="header">Exploitation de Xemelios</p>
      <p class="p1"><ul>
         <li style="list-style-type: square;"><a href="#backup">Sauvegardes</a></li>
         <li style="margin-left: 1cm; list-style-type: circle;"><a href="#sauvegarde">Sauvegarde</a></li>
         <li style="margin-left: 1cm; list-style-type: circle;"><a href="#restauration">Restauration</a></li>
         <li style="margin-left: 1cm; list-style-type: circle;"><a href="#transfert">Transferts de base de donn&eacute;es</a></li>
         <li style="list-style-type: square;"><a href="#repair">R&eacute;paration de la base de donn&eacute;es</a></li>
      </ul></p>
      <h1><a name="backup"/>Sauvegardes</h1>
      <p class="p1">Xemelios enregistre toutes les informations des documents
         import&eacute;s dans une base de donn&eacute;es MySQL. Tant que les documents
         import&eacute;s sont conserv&eacute;s, il n'est pas n&eacute;cessaire de faire
         de sauvegardes de la base de donn&eacute;es, il suffit de r&eacute;importer les
         fichiers. N&eacute;anmoins, certains services informatiques peuvent imposer des
         sauvegardes de cette base, afin d'assurer une meilleure continuit&eacute; de service.
         Ce paragraphe d&eacute;taille les proc&eacute;dures de sauvegarde et de restauration de
         la base de donn&eacute;es.</p>
      <h2><a name="sauvegarde"/>Sauvegarde</h2>
      <p class="p2">Nous supposerons dans le document que X&eacute;M&eacute;Lios est install&eacute; dans 
         <span class="code">C:\Program&nbsp;Files\DGCP\Xemelios</span> .</p>
      <p class="p2">Tout d'abord, il faut identifier sur quel ordinateur les donn&eacute;es sont. Dans
         le cas d'une installation monoposte, c'est l'ordinateur o&ugrave; est install&eacute; X&eacute;M&eacute;Lios. Dans le
         cas d'une installation client-serveur, c'est l'ordinateur qui fait office de serveur. Dans
         tous les cas, il est possible de v&eacute;rifier cela en consultant le fichier
         <span class="code">C:\Program&nbsp;Files\DGCP\Xemelios\Xemelios\root\mysql.properties</span> .
         Le nom ou l'adresse IP du serveur se trouve dans la ligne commen&ccedil;ant par <span class="code">database.url=</span> .</p>
      <p class="p2">Il faut ensuite arrêter le service <span class="code">MySqlForXemelios</span>. Pour savoir comment arr&ecirc;ter 
         ou d&eacute;marrer un service, se reporter &agrave; la documentation de Windows.</p>
      <p class="p2">Les fichiers &agrave; sauvegarder se trouvent dans le r&eacute;pertoire <span class="code">C:\Program&nbsp;Files\DGCP\Xemelios\MySqlServer\MySQL&nbsp;Server&nbsp;5.0\data\xemelios</span> .
         Il faut sauvegarder tous les fichiers, &agrave; l'exception de <span class="code">db.opt</span> .</p>
      <p class="p2">Une fois tous les fichiers sauvegard&eacute;s, il faut red&eacute;marrer le service <span class="code">MySqlForXemelios</span> .</p>
      <h2><a name="restauration"/>Restauration</h2>
      <p class="p2">La restauration n&eacute;cessite les m&ecirc;mes op&eacute;rations que la sauvegarde :</p>
      <p class="p2">Arr&ecirc;t du service <span class="code">MySqlForXemelios</span> .</p>
      <p class="p2">Restauration des fichiers dans <span class="code">C:\Program&nbsp;Files\DGCP\Xemelios\MySqlServer\MySQL&nbsp;Server&nbsp;5.0\data\xemelios</span> .
         L&agrave; encore, le fichier <span class="code">db.opt</span> ne doit pas &ecirc;tre restaur&eacute;.</p>
      <p class="p2">Red&eacute;marrage du service <span class="code">MySqlForXemelios</span> .</p>
      <h2><a name="transfert"/>Transferts de base de donn&eacute;es</h2>
      <p class="p2">A l'aide d'une op&eacute;ration de sauvegarde et de restauration, il est possible de
         transf&eacute;rer une base de donn&eacute;es X&eacute;M&eacute;Lios d'un ordinateur source &agrave; un ordinateur cible. Il
         faut commencer par r&eacute;aliser une <a href="#sauvegarde">sauvegarde</a> de la base de donn&eacute;es de l'ordinateur source.
         Puis il faut installer un X&eacute;M&eacute;Lios serveur sur l'ordinateur cible. Enfin, il faut <a href="#restauration">restaurer</a> la
         sauvegarde sur l'ordinateur cible.</p>
      <h1><a name="repair"/>R&eacute;paration de la base de donn&eacute;es</h1>
      <p class="p1">Il peut arriver que la base de donn&eacute;es de Xemelios soit endommag&eacute;e. Cela se traduit en g&eacute;n&eacute;ral par l'impossibilit&eacute; d'executer la moindre recherche. Dans ce cas,
      il faut consulter les fichiers de logs pour identifier l'erreur : si vous rencontrez quelque chose qui ressemble &agrave; cela, alors la r&eacute;paration s'impose !
      </p>
      <pre>
         ERROR [mysql.MySqlDataResultSet] AWT-EventQueue-0 08:08:03,609: in next():
         fr.gouv.finances.dgfip.xemelios.data.DataAccessException: java.sql.SQLException: Table 'PAYE_ETATPAYE_DOCUMENTS' <b style="color: red;">is marked as crashed and should be repaired</b>
         
         Query being executed when exception was thrown:
         SELECT ....
      </pre>
      <p>La documentation pour la r&eacute;paration de la base de donn&eacute;es est disponible <a href="http://xemelios.org/tools/maintenance-base.html">en ligne</a>.</p>
   </body>
</html>